/**
 * ASR (Automatic Speech Recognition) correction patterns.
 * Ported from scripts/auto-correct-bible.mjs.
 *
 * Each entry is [regex, replacement].
 * Order matters — specific fixes before generic whitespace cleanup.
 */
export const ASR_CORRECTIONS: [RegExp, string][] = [
  // ── Repeated character cleanup (4+ same char → 1) ──
  [/(.)\1{3,}/g, "$1"],

  // ── Sacred terms frequently split by ASR ──
  [/하나\s*님/g, "하나님"],
  [/예수\s*님/g, "예수님"],
  [/주\s*님/g, "주님"],
  [/그리스\s*도/g, "그리스도"],
  [/성\s*령/g, "성령"],

  // ── Common ASR misrecognitions (theology/Bible terms) ──
  [/일법/g, "율법"],
  [/하느님/g, "하나님"],
  [/안식이를/g, "안식일을"],
  [/안식이가/g, "안식일이"],
  [/안식이에/g, "안식일에"],
  [/가늠하지/g, "간음하지"],
  [/두석질/g, "도적질"],
  [/사신하지/g, "살인하지"],
  [/망령띵/g, "망령되이"],
  [/보좰/g, "보좌"],
  [/아맨/g, "아멘"],
  [/알렐루야/g, "할렐루야"],
  [/빌리바/g, "빌립"],
  [/빌리비/g, "빌립"],
  [/과위똥/g, "바윗돌"],
  [/의료우/g, "의로우"],
  [/의료음/g, "의로움"],
  [/정주한/g, "정죄한"],
  [/초소가/g, "처소가"],
  [/초소를/g, "처소를"],
  [/초소는/g, "처소는"],
  [/거쳐올/g, "거할"],
  [/거쳐가/g, "거처가"],
  [/그스도/g, "그리스도"],
  [/수역에서/g, "수렁에서"],

  // ── 사단/마귀 관련 ──
  [/사탄막이/g, "사단 마귀"],
  [/사탄막귀/g, "사단 마귀"],
  [/사탄/g, "사단"],

  // ── 강건 오인식 ──
  [/강간하게/g, "강건하게"],
  [/강간함/g, "강건함"],
  [/당건하게/g, "강건하게"],

  // ── 교회/직함 ──
  [/열세 가족/g, "연세 가족"],
  [/열체 가족/g, "연세 가족"],
  [/연체중앙/g, "연세중앙"],
  [/연체 교회/g, "연세 교회"],
  [/단임목사/g, "담임목사"],
  [/다님목사/g, "담임목사"],
  [/다림목사/g, "담임목사"],
  [/단임 목사/g, "담임목사"],
  [/다님 목사/g, "담임목사"],
  [/다림 목사/g, "담임목사"],
  [/담임 목사/g, "담임목사"],

  // ── 주의 사자 오인식 ──
  [/주의 서져/g, "주의 사자"],
  [/주의 선자/g, "주의 사자"],
  [/지의 사자/g, "주의 사자"],
  [/지위 사자/g, "주의 사자"],

  // ── 기도문 패턴 ──
  [/희질한 육체/g, "기진한 육체"],
  [/기지한 육체/g, "기진한 육체"],
  [/기질한 육체/g, "기진한 육체"],
  [/주여 삼청/g, "주여 삼창"],
  [/주여주여/g, "주여 주여"],
  [/주여 여여/g, "주여 주여"],
  [/주여 주야/g, "주여 주여"],
  [/아멘할렐루야/g, "아멘 할렐루야"],

  // ── 일반 단어 오인식 ──
  [/신학생활/g, "신앙생활"],
  [/신생활/g, "신앙생활"],
  [/제명의 말씀/g, "생명의 말씀"],
  [/염령/g, "영력"],
  [/애잘하고/g, "애절하고"],
  [/갑죽게/g, "값지게"],
  [/갑지게/g, "값지게"],
  [/치력을/g, "체력을"],
  [/(?<![가-힣])송도/g, "성도"],
  [/총만/g, "충만"],
  [/낭막/g, "낙망"],
  [/읍니다/g, "습니다"],
  [/죽님/g, "주님"],
  [/신민지/g, "식민지"],
  [/추성 명절/g, "추석 명절"],
  [/중구 등부/g, "중고등부"],
  [/수중 드는/g, "수종 드는"],
  [/열약하여/g, "연약하여"],
  [/권수 있게/g, "권세 있게"],
  [/주 주님/g, "주님"],

  // ── Common worship/theology terms ──
  [/예배요/g, "옛 뱀이요"],
  [/예베소서/g, "에베소서"],
  [/윤석전목사/g, "윤석전 목사"],
  [/윤석 전/g, "윤석전"],

  // ── 노이즈 태그 제거 ──
  [/\[음악\]/g, ""],
  [/\[박수\]/g, ""],
  [/\[웃음\]/g, ""],

  // ── Scripture notation normalization ──
  [/요한 계시록/g, "요한계시록"],
  [/(\d+)\s*장\s*(\d+)\s*절/g, "$1장 $2절"],
  [/(\d+)\s*:\s*(\d+)/g, "$1:$2"],

  // ── Book name expansions (abbreviated → full) ──
  [/\b고전\s*(\d+)/g, "고린도전서 $1"],
  [/\b고후\s*(\d+)/g, "고린도후서 $1"],
  [/\b살전\s*(\d+)/g, "데살로니가전서 $1"],
  [/\b살후\s*(\d+)/g, "데살로니가후서 $1"],
  [/\b딤전\s*(\d+)/g, "디모데전서 $1"],
  [/\b딤후\s*(\d+)/g, "디모데후서 $1"],
  [/\b벧전\s*(\d+)/g, "베드로전서 $1"],
  [/\b벧후\s*(\d+)/g, "베드로후서 $1"],
  [/\b요일\s*(\d+)/g, "요한일서 $1"],
  [/\b요이\s*(\d+)/g, "요한이서 $1"],
  [/\b요삼\s*(\d+)/g, "요한삼서 $1"],

  // ── Stray ASR digit removal ──
  // 한글 사이에 끼인 1-2자리 숫자, 뒤에 카운터/단위 없는 경우 제거
  [
    /(?<=[가-힣])\s+\d{1,2}(?=\s+(?!년|월|일|시|분|초|장|절|번|째|차|개|명|원|만|억|배|세|살|편|과|가지|조|호|주|단|쪽|권|대|종|부|위|기|층|회|학)[가-힣])/g,
    "",
  ],
  // 연속된 숫자 (2개 이상) 한글 사이에 끼인 경우
  [
    /(?<=[가-힣])(?:\s+\d{1,2}){2,}(?=\s+(?!년|월|일|시|분|초|장|절|번|째|차|개|명|원|만|억|배|세|살|편|과|가지|조|호|주|단|쪽|권|대|종|부|위|기|층|회|학)[가-힣])/g,
    "",
  ],

  // ── Whitespace cleanup (must be last) ──
  [/ {2,}/g, " "],
];

/** Apply all ASR corrections to a text string. */
export function applyAsrCorrections(text: string): string {
  let out = text;
  for (const [pattern, replacement] of ASR_CORRECTIONS) {
    out = out.replace(pattern, replacement);
  }
  return out.trim();
}
